# MUD游戏 v4.0 地图系统说明

## 版本信息
- **版本号**: v4.0
- **更新日期**: 2025-01-07
- **更新内容**: 美化地图系统 + 方向移动

---

## 🗺️ 核心新功能：美化地图系统

### 功能概述
游戏现在拥有一个**可视化的地图系统**，场景之间有明确的上下左右位置关系，玩家可以通过方向键移动，地图会实时显示当前位置和可移动方向。

### 地图布局

```
╔════════════════════════════════════════════════════════════════╗
║                     【 武 林 地 图 】                        ║
╠════════════════════════════════════════════════════════════════╣
║                                                                ║
║      藏经阁  ─→─  新手村  ─→─                                 ║
║        │            │                                         ║
║        │            │                                         ║
║      藏经阁  ─→─  武林广场  ─→─  练功房                       ║
║        │            │                                         ║
║        │            │                                         ║
║                    江湖客栈                                    ║
║                                                                ║
╠════════════════════════════════════════════════════════════════╣
║  当前位置: 武林广场                                            ║
║  可移动方向: ↑ 北  ↓ 南  → 东  ← 西                          ║
╚════════════════════════════════════════════════════════════════╝
```

### 场景位置关系

#### 地图坐标系统
- **坐标原点**: 左上角为 (0, 0)
- **X轴**: 从左到右（西→东）
- **Y轴**: 从上到下（北→南）

#### 场景分布

| 场景 | 坐标 | 位置关系 |
|------|------|----------|
| 新手村 | (2, 0) | 最上方，武林广场的北方 |
| 武林广场 | (2, 2) | 地图中心，连接所有场景 |
| 藏经阁 | (0, 2) | 武林广场的西方 |
| 练功房 | (4, 2) | 武林广场的东方 |
| 江湖客栈 | (2, 4) | 武林广场的南方 |

#### 连接关系

```
        新手村 (2,0)
           ↓
    藏经阁 ← 武林广场 → 练功房
    (0,2)   (2,2)    (4,2)
           ↓
       江湖客栈 (2,4)
```

### 移动系统

#### 方向移动命令

玩家可以通过以下方式移动：

| 方向 | 英文命令 | 中文命令 | 说明 |
|------|---------|---------|------|
| 北（上） | `n` 或 `north` | `上` 或 `北` | 向上移动 |
| 南（下） | `s` 或 `south` | `下` 或 `南` | 向下移动 |
| 东（右） | `e` 或 `east` | `右` 或 `东` | 向右移动 |
| 西（左） | `w` 或 `west` | `左` 或 `西` | 向左移动 |

#### 其他命令

- `list` - 查看所有场景的详细列表
- `map` - 重新显示地图

### 地图显示特性

#### 1. 实时位置标记
- 当前位置用 `【场景名】` 标记
- 其他场景用 ` 场景名 ` 显示

#### 2. 方向指示
- 水平连接：`─→─` 表示东西方向连接
- 垂直连接：`│` 表示南北方向连接

#### 3. 可移动方向显示
地图底部显示当前可移动的方向：
```
可移动方向: ↑ 北  ↓ 南  → 东  ← 西
```

### 使用示例

#### 示例1：查看地图
```
输入: 9 (切换场景)
输入: map

╔════════════════════════════════════════════════════════════════╗
║                     【 武 林 地 图 】                        ║
╠════════════════════════════════════════════════════════════════╣
║                                                                ║
║      藏经阁  ─→─  【新手村】  ─→─                             ║
║        │            │                                         ║
║        │            │                                         ║
║      藏经阁  ─→─   武林广场  ─→─  练功房                       ║
║        │            │                                         ║
║        │            │                                         ║
║                    江湖客栈                                    ║
║                                                                ║
╠════════════════════════════════════════════════════════════════╣
║  当前位置: 新手村                                              ║
║  可移动方向: ↓ 南                                              ║
╚════════════════════════════════════════════════════════════════╝
```

#### 示例2：方向移动
```
当前位置: 武林广场

输入: 9 (切换场景)
输入: n (或 north/上/北)

════════════════════════════════════════════════════════════════
你已到达【新手村】
宁静的村庄，适合新手修炼
════════════════════════════════════════════════════════════════
```

#### 示例3：查看场景列表
```
输入: 9 (切换场景)
输入: list

┌────────────────────────────────────────────────────────────┐
│                      地图说明                             │
├────────────────────────────────────────────────────────────┤
│  新手村      - 宁静的村庄，适合新手修炼                     │
│  武林广场    - 江湖人士聚集地，可以切磋武艺                 │
│  藏经阁      - 存放武学秘籍的地方                           │
│  练功房      - 专门用于修炼的场所                           │
│  江湖客栈    - 休息和交流的地方                             │
└────────────────────────────────────────────────────────────┘
```

---

## 🎨 地图美化特性

### 1. ASCII艺术边框
- 使用 `╔═══╗` 等Unicode字符创建美观边框
- 清晰的视觉分隔

### 2. 场景名称显示
- 当前位置：`【场景名】`（带方括号）
- 其他位置：` 场景名 `（空格包围）

### 3. 连接线显示
- 水平连接：`─→─`（带箭头）
- 垂直连接：`│`（竖线）

### 4. 信息面板
- 当前位置显示
- 可移动方向列表
- 场景描述

---

## 🔧 技术实现

### 新增类

#### MapManager.java
- **功能**: 地图管理器
- **职责**:
  - 管理场景节点和位置关系
  - 生成美化地图显示
  - 处理方向移动
  - 生成地图说明

#### SceneNode (内部类)
- **属性**:
  - `Scene scene` - 场景对象
  - `int x, y` - 坐标
  - `SceneNode north, south, east, west` - 四个方向的连接

### 修改类

#### NetworkGameServer.java
- 添加 `MapManager` 实例
- `ClientHandler.currentScene` 改为 `MapManager.SceneNode` 类型
- 修改场景切换功能，支持方向移动
- 菜单中显示美化地图

### 地图初始化

地图在 `MapManager` 构造函数中初始化：
1. 创建5个场景节点
2. 设置场景坐标
3. 建立方向连接关系
4. 设置场景可用操作

---

## 🎮 游戏体验改进

### 1. 空间感增强
- 玩家可以清楚地看到场景之间的位置关系
- 方向移动更符合直觉

### 2. 探索乐趣
- 通过方向移动探索地图
- 发现场景之间的连接关系

### 3. 导航便利
- 地图实时显示当前位置
- 清楚显示可移动方向
- 支持多种移动命令（中英文）

### 4. 视觉美化
- 美观的ASCII艺术地图
- 清晰的视觉层次
- 专业的边框设计

---

## 📝 使用指南

### 基本操作

1. **查看地图**
   - 主菜单会自动显示地图
   - 或输入 `9` → `map`

2. **移动场景**
   - 输入 `9` 进入移动菜单
   - 输入方向命令（如 `n`, `s`, `e`, `w`）
   - 或使用中文（如 `上`, `下`, `左`, `右`）

3. **查看场景列表**
   - 输入 `9` → `list`
   - 查看所有场景的详细信息

### 移动技巧

1. **记住位置关系**
   - 武林广场是中心，连接所有场景
   - 新手村在最上方
   - 江湖客栈在最下方

2. **快速移动**
   - 使用简短命令：`n`, `s`, `e`, `w`
   - 或使用中文：`上`, `下`, `左`, `右`

3. **查看地图**
   - 不确定位置时输入 `map`
   - 地图会高亮显示当前位置

---

## 🗺️ 地图布局详解

### 完整地图结构

```
         [新手村]
            │
            ↓
    [藏经阁] ← → [武林广场] ← → [练功房]
            │
            ↓
        [江湖客栈]
```

### 场景功能分布

| 场景 | 位置 | 功能 | 连接 |
|------|------|------|------|
| 新手村 | 最北 | 打怪、NPC | 南→武林广场 |
| 武林广场 | 中心 | 打怪、NPC、PK | 连接所有场景 |
| 藏经阁 | 最西 | NPC、查看状态 | 东→武林广场 |
| 练功房 | 最东 | 打怪、查看状态 | 西→武林广场 |
| 江湖客栈 | 最南 | NPC、聊天、查看玩家 | 北→武林广场 |

---

## 🎯 策略建议

### 移动策略

1. **中心策略**
   - 武林广场是中心，可以快速到达任何场景
   - 需要频繁切换场景时，先到武林广场

2. **功能导向**
   - 打怪：新手村、武林广场、练功房
   - NPC对话：新手村、武林广场、藏经阁、江湖客栈
   - PK：仅武林广场

3. **效率优化**
   - 规划好移动路线，减少不必要的移动
   - 记住常用场景的位置关系

---

## 🐛 已知问题

无重大已知问题。

---

## 📞 更新日志

### v4.0 (2025-01-07)

#### 新增功能
✅ 美化地图系统
  - 可视化地图显示
  - ASCII艺术边框
  - 实时位置标记

✅ 方向移动系统
  - 支持上下左右移动
  - 多种命令格式（中英文）
  - 方向连接关系

✅ 地图管理器
  - 场景节点系统
  - 坐标管理
  - 连接关系管理

#### 改进内容
- 场景切换改为方向移动
- 菜单中集成地图显示
- 增强空间感和探索乐趣

---

## 🚀 快速开始

### 编译
```bash
cd D:\java\USST

# 编译新文件
javac -encoding UTF-8 -cp "lib/gson-2.10.1.jar;out/production/USST" -d out/production/USST src/com/mudgame/MapManager.java
javac -encoding UTF-8 -cp "lib/gson-2.10.1.jar;out/production/USST" -d out/production/USST src/com/mudgame/NetworkGameServer.java
```

### 测试
1. 启动服务器和客户端
2. 查看主菜单中的地图
3. 输入 `9` 测试方向移动
4. 尝试不同方向命令
5. 输入 `map` 查看地图
6. 输入 `list` 查看场景列表

---

*文档版本: 4.0*  
*最后更新: 2025-01-07*

